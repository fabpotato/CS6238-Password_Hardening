package edu.gatech.scs.pwd.hardening;
import java.math.*;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.util.List;

import au.com.bytecode.opencsv.CSVReader;

public class LoginAttempt{

	
	BigInteger[] featureValuesReceived = new BigInteger[16];
	private String fileDir = ""; 
	public String pwd;
	
	
	BigInteger[] thresholdValues = new BigInteger[16];
	
	public BigInteger[] loginAttempt() throws NumberFormatException, IOException{
		
		//Generating a string that denotes the path to the directory of loginfeaturevalues.txt file. 
		fileDir = new String("loginAndThresholdFeatureValues"
                + File.separator);
		
		
		
		//Using an external library to parse through the CSV file of login features that we pretend we received from the client.
	
			CSVReader reader = new CSVReader(new FileReader(fileDir + "loginfeaturevalues.txt"));
			
			
			//To  temporarily read the lines from the file
		    String [] nextLine;
		    
		    
		    //Iterating through the lines
		    while ((nextLine = reader.readNext()) != null) {
		        // nextLine[] is an array of values from the line
		        	    	
		    	//Extracting password and featurevalues from the loginfeaturevalues.txt file and storing them in an integer array.
		    	
		    	pwd = nextLine[15]; //Password is the last value in the loginfeaturevalues csv file
		    	System.out.println(pwd);
		    	
		    	for(int i=0; i<15; i++){
		    
		    			featureValuesReceived[i+1] = BigInteger.valueOf(Integer.parseInt(nextLine[i]));
		    			System.out.println(featureValuesReceived[i+1]);
		    	}
		    }
			
		    reader.close();
				
		return featureValuesReceived;
		
		
	}
	
	
	
	//For reading threshold values and storing in an array of integers
	public BigInteger[] fetchThresholdValues() throws NumberFormatException, IOException{
		
		//Generating a string that denotes the path to the directory of thresholdvalues.txt file. 
		fileDir = new String("loginAndThresholdFeatureValues"
                + File.separator);
		
		
			//Using an external library to parse through the CSV file of threshold values
			CSVReader reader = new CSVReader(new FileReader(fileDir + "threshold.txt"));
						
			
			//To  temporarily read the lines from the file
		    String [] nextLine;
		    
		    //Iterating through all the lines in the file
		    while ((nextLine = reader.readNext()) != null) {
		        // nextLine[] is an array of values from the line
		   		    	
		    	
		    	//Extracting thresholdvalues from the thresholdvalues.txt file and storing them in an integer array.
		    	for(int i=0; i<15; i++){
		    		
		    			thresholdValues[i+1] = BigInteger.valueOf(Integer.parseInt(nextLine[i]));
		    			System.out.println("\n"+thresholdValues[i+1]);
		    	}
		    }
			
			
		    reader.close();
		
		return thresholdValues;
	}
	
	
	
	
	//Calculate mean of feature values by fetching them from the history file
	public int calculateMean(int[] d){
		
		
		return 0;
		
	}
	
	
	//Calculate median of feature values by fetching them from the history file
	public int calculateMedian(int[] d){
		
		return 0;
	}
	
	
	//Based on mean and standard deviation
	public int selectShare(){
		
		
		return 1;
		
	}
	
	
	//To calculate the y co-ordinates
	public BigInteger calculateHpwdnew(BigInteger[] y,BigInteger[] x, BigInteger q){
		
		/*BigDecimal hpwd=new BigDecimal(0);
		System.out.println("Q is"+q);
		for(int i =0;i<15;i++)
		{
			hpwd=hpwd.add((new BigDecimal(y[i]).multiply(calculateLagrangeMultiplier(x[i],i,x)).remainder(new BigDecimal(q))));
		}
		return hpwd;*/
		BigInteger hpwd =  BigInteger.valueOf(0);
		for(int i=1;i<=15;i++)
		{
			BigInteger mul =  BigInteger.valueOf(1);
			for(int j=1;j<=15;j++)
			{
				if(j!=i)
				{
					//System.out.println("j and i are "+j+" and "+i);
					//System.out.println("Value of x[j] and x[i] is "+x[j]+" and "+x[i]);
					mul=mul.multiply(x[j].divide(x[j].subtract(x[i])));	
				}
				//System.out.println(mul);
				hpwd=hpwd.add(mul.multiply(y[i]).mod(q));
			}
		}
		return hpwd;
	}
	
	
	//Calculating lagrange multiplier
	public BigDecimal calculateLagrangeMultiplier(BigInteger xi,int i, BigInteger[] x){
		
		BigDecimal LagrangeMultiplier=new BigDecimal(1);
		for(int j=1;j<=15;j++)
		{	
			if(j==i)
			{
				//Do nothing
				System.out.println("Catching j=i");
			}
			else
			{
			System.out.println("Value of x[j] and x[i] is "+x[j]+" and "+x[i]);
			System.out.println("Subtraction of x[j] and x[i] is "+x[j].subtract(x[i]));
			BigDecimal div_part= new BigDecimal(x[j]).subtract(new BigDecimal(x[i]));
			LagrangeMultiplier=LagrangeMultiplier.multiply(new BigDecimal(x[j]).divide(div_part,3,RoundingMode.HALF_UP));
			}
		}
		//System.out.println("LagrangeMultiplier for i = "+i+" is "+LagrangeMultiplier+".");
		return LagrangeMultiplier;
		
		
	}
	
	
}
